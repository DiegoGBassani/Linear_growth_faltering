
// PROJECT: Matters Arising response to Benjamin-Chung et al. 2023
// PROGRAM: Matters_arising_supp_code_20231215
// TASK: Simulate population datasets w/ missingness 
// CREATED BY: Kelly Watson, The Hospital for Sick Children
// DATE: December 15, 2023

*****************************************
*****************************************

*** Simulate dataset assuming no missingness

clear
set obs 10000

matrix V =   (1.0, 0.79, 0.79, 0.79, 0.78, 0.78, 0.77, 0.77, 0.77, 0.76, 0.76, 0.75, 0.75, 0.75, 0.74, 0.74, 0.73, 0.73, 0.73, 0.72, 0.72, 0.71, 0.71, 0.71, 0.70)  
matrix V =   V\ (0.79,  1.0, 0.81, 0.80, 0.80, 0.79, 0.79, 0.79, 0.78, 0.78, 0.77, 0.77, 0.77, 0.76, 0.76, 0.75, 0.75, 0.75, 0.74, 0.74, 0.73, 0.73, 0.73, 0.72, 0.72)  
matrix V =   V\ (0.79, 0.81,  1.0, 0.82, 0.81, 0.81, 0.81, 0.80, 0.80, 0.79, 0.79, 0.79, 0.78, 0.78, 0.77, 0.77, 0.77, 0.76, 0.76, 0.75, 0.75, 0.75, 0.74, 0.74, 0.73) 
matrix V =   V\ (0.79, 0.80, 0.82,  1.0, 0.83, 0.83, 0.82, 0.82, 0.81, 0.81, 0.81, 0.80, 0.80, 0.79, 0.79, 0.79, 0.78, 0.78, 0.77, 0.77, 0.77, 0.76, 0.76, 0.75, 0.75)
matrix V =   V\ (0.78, 0.80, 0.81, 0.83,  1.0, 0.84, 0.84, 0.83, 0.83, 0.83, 0.82, 0.82, 0.81, 0.81, 0.81, 0.80, 0.80, 0.79, 0.79, 0.79, 0.78, 0.78, 0.77, 0.77, 0.77)
matrix V =   V\ (0.78, 0.79, 0.81, 0.83, 0.84,  1.0, 0.85, 0.85, 0.85, 0.84, 0.84, 0.83, 0.83, 0.83, 0.82, 0.82, 0.81, 0.81, 0.81, 0.80, 0.80, 0.79, 0.79, 0.79, 0.78)
matrix V =   V\ (0.77, 0.79, 0.81, 0.82, 0.84, 0.85,  1.0, 0.87, 0.86, 0.86, 0.85, 0.85, 0.85, 0.84, 0.84, 0.83, 0.83, 0.83, 0.82, 0.82, 0.81, 0.81, 0.81, 0.80, 0.80)
matrix V =   V\ (0.77, 0.79, 0.80, 0.82, 0.83, 0.85, 0.87,  1.0, 0.88, 0.87, 0.87, 0.87, 0.86, 0.86, 0.85, 0.85, 0.85, 0.84, 0.84, 0.83, 0.83, 0.83, 0.82, 0.82, 0.81)
matrix V =   V\ (0.77, 0.78, 0.80, 0.81, 0.83, 0.85, 0.86, 0.88,  1.0, 0.89, 0.89, 0.88, 0.88, 0.87, 0.87, 0.87, 0.86, 0.86, 0.85, 0.85, 0.85, 0.84, 0.84, 0.83, 0.83)
matrix V =   V\ (0.76, 0.78, 0.79, 0.81, 0.83, 0.84, 0.86, 0.87, 0.89,  1.0, 0.90, 0.90, 0.89, 0.89, 0.89, 0.88, 0.88, 0.87, 0.87, 0.87, 0.86, 0.86, 0.85, 0.85, 0.85)
matrix V =   V\ (0.76, 0.77, 0.79, 0.81, 0.82, 0.84, 0.85, 0.87, 0.89, 0.90,  1.0, 0.91, 0.91, 0.91, 0.90, 0.90, 0.89, 0.89, 0.89, 0.88, 0.88, 0.87, 0.87, 0.87, 0.86)
matrix V =   V\ (0.75, 0.77, 0.79, 0.80, 0.82, 0.83, 0.85, 0.87, 0.88, 0.90, 0.91,  1.0, 0.93, 0.92, 0.92, 0.91, 0.91, 0.91, 0.90, 0.90, 0.89, 0.89, 0.89, 0.88, 0.88)
matrix V =   V\ (0.75, 0.77, 0.78, 0.80, 0.81, 0.83, 0.85, 0.86, 0.88, 0.89, 0.91, 0.93,  1.0, 0.94, 0.93, 0.93, 0.93, 0.92, 0.92, 0.91, 0.91, 0.91, 0.90, 0.90, 0.89)
matrix V =   V\ (0.75, 0.76, 0.78, 0.79, 0.81, 0.83, 0.84, 0.86, 0.87, 0.89, 0.91, 0.92, 0.94,  1.0, 0.95, 0.95, 0.94, 0.94, 0.93, 0.93, 0.93, 0.92, 0.92, 0.91, 0.91)
matrix V =   V\ (0.74, 0.76, 0.77, 0.79, 0.81, 0.82, 0.84, 0.85, 0.87, 0.89, 0.90, 0.92, 0.93, 0.95,  1.0, 0.96, 0.96, 0.95, 0.95, 0.95, 0.94, 0.94, 0.93, 0.93, 0.93)
matrix V =   V\ (0.74, 0.75, 0.77, 0.79, 0.80, 0.82, 0.83, 0.85, 0.87, 0.88, 0.90, 0.91, 0.93, 0.95, 0.96,  1.0, 0.97, 0.97, 0.97, 0.96, 0.96, 0.95, 0.95, 0.95, 0.94)
matrix V =   V\ (0.73, 0.75, 0.77, 0.78, 0.80, 0.81, 0.83, 0.85, 0.86, 0.88, 0.89, 0.91, 0.93, 0.94, 0.96, 0.97,  1.0, 0.99, 0.98, 0.98, 0.97, 0.97, 0.97, 0.96, 0.96)
matrix V =   V\ (0.73, 0.75, 0.76, 0.78, 0.79, 0.81, 0.83, 0.84, 0.86, 0.87, 0.89, 0.91, 0.92, 0.94, 0.95, 0.97, 0.99,  1.0, 0.99, 0.99, 0.99, 0.99, 0.98, 0.98, 0.97)
matrix V =   V\ (0.73, 0.74, 0.76, 0.77, 0.79, 0.81, 0.82, 0.84, 0.85, 0.87, 0.89, 0.90, 0.92, 0.93, 0.95, 0.97, 0.98, 0.99,  1.0, 0.99, 0.99, 0.99, 0.99, 0.99, 0.99)
matrix V =   V\ (0.72, 0.74, 0.75, 0.77, 0.79, 0.80, 0.82, 0.83, 0.85, 0.87, 0.88, 0.90, 0.91, 0.93, 0.95, 0.96, 0.98, 0.99, 0.99,  1.0, 0.99, 0.99, 0.99, 0.99, 0.99)
matrix V =   V\ (0.72, 0.73, 0.75, 0.77, 0.78, 0.80, 0.81, 0.83, 0.85, 0.86, 0.88, 0.89, 0.91, 0.93, 0.94, 0.96, 0.97, 0.99, 0.99, 0.99,  1.0, 0.99, 0.99, 0.99, 0.99)
matrix V =   V\ (0.71, 0.73, 0.75, 0.76, 0.78, 0.79, 0.81, 0.83, 0.84, 0.86, 0.87, 0.89, 0.91, 0.92, 0.94, 0.95, 0.97, 0.99, 0.99, 0.99, 0.99,  1.0, 0.99, 0.99, 0.99)
matrix V =   V\ (0.71, 0.73, 0.74, 0.76, 0.77, 0.79, 0.81, 0.82, 0.84, 0.85, 0.87, 0.89, 0.90, 0.92, 0.93, 0.95, 0.97, 0.98, 0.99, 0.99, 0.99, 0.99,  1.0, 0.99, 0.99)
matrix V =   V\ (0.71, 0.72, 0.74, 0.75, 0.77, 0.79, 0.80, 0.82, 0.83, 0.85, 0.87, 0.88, 0.90, 0.91, 0.93, 0.95, 0.96, 0.98, 0.99, 0.99, 0.99, 0.99, 0.99,  1.0, 0.99)
matrix V =   V\ (0.70, 0.72, 0.73, 0.75, 0.77, 0.78, 0.80, 0.81, 0.83, 0.85, 0.86, 0.88, 0.89, 0.91, 0.93, 0.94, 0.96, 0.97, 0.99, 0.99, 0.99, 0.99, 0.99, 0.99,  1.0)

matrix list V

drawnorm laz0 laz1 laz2 laz3 laz4 laz5 laz6 laz7 laz8 laz9 laz10 laz11 laz12 laz13 laz14 laz15 laz16 laz17 laz18 laz19 laz20 laz21 laz22 laz23 laz24, means(-1.0, -1.0, -1.2, -1.27, -1.30, -1.33, -1.37, -1.42, -1.48, -1.54, -1.61, -1.69, -1.76, -1.82, -1.86, -1.92, -1.98, -2.04, -2.09, -2.10, -2.09, -2.08, -2.06, -2.05, -2.01) sds(1.1, 1.1, 1.1, 1.1, 1.1, 1.1, 1.1, 1.1, 1.1, 1.1, 1.1, 1.1, 1.1, 1.1, 1.1, 1.1, 1.1, 1.1, 1.1, 1.1, 1.1, 1.1, 1.1, 1.1, 1.1) seed(81625) corr(V) forcepsd

keep laz0 laz3

*****************************************
*** Add varying levels of missingness to dataset at birth

*** 10% missingness
* Flag every 10th observation
gen byte tag = mod(_n, 10) == 0
replace laz0 =. if tag==1
* Determine stunting prevalence at birth
count if laz0<-2
count if laz0!=.
display 1676/9000
* Determine incident stunting onset between 0-3 mos
count if laz0>=-2 & laz3<-2 & tag==0
count if laz3<-2 & tag==1
display (1046+255)/10000

*** 20% missingness
gen byte tag = mod(_n, 5) == 0
replace laz0 =. if tag==1
* Repeat steps above for determining incident stunting onset (0mos, 0-3mos)

*** 25% missingness
gen byte tag = mod(_n, 4) == 0
display (896+622)/10000
* Repeat steps above for determining incident stunting onset (0mos, 0-3mos)

*****************************************
*****************************************
